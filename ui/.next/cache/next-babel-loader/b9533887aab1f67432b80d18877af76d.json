{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n// import fetch from  \"node-fetch\"\nimport axios from 'axios';\nvar tokenUrl = \"https://api.awhere.com/oauth/token\";\nvar baseApiUrl = process.env.BASE_API_URL;\n\nvar forecastsUrl = function forecastsUrl(lat, lon) {\n  return \"\".concat(baseApiUrl, \"/weather/locations/\").concat(lat, \",\").concat(lon, \"/forecasts\");\n};\n\nvar dailyWeatherUrl = function dailyWeatherUrl(lat, lon) {\n  var date = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : \"\";\n  var result = \"\".concat(baseApiUrl, \"/weather/locations/\").concat(lat, \",\").concat(lon, \"/forecasts\");\n\n  if (date) {\n    result = \"\".concat(result, \"/\").concat(date);\n  }\n\n  return result;\n};\n\nexport var getForecasts = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(lat, lon) {\n    var access_token, url, req, res;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return getAccessToken();\n\n          case 2:\n            access_token = _context.sent;\n            url = forecastsUrl(lat, lon);\n            _context.next = 6;\n            return axios.get(url, {\n              headers: {\n                Authorization: \"Bearer \".concat(access_token),\n                \"Access-Control-Allow-Origin\": \"*\",\n                \"Access-Control-Allow-Methods\": \"*\",\n                \"Access-Control-Allow-Headers\": \"*\"\n              }\n            });\n\n          case 6:\n            req = _context.sent;\n            _context.next = 9;\n            return req.data;\n\n          case 9:\n            res = _context.sent;\n            console.log(res);\n            return _context.abrupt(\"return\", res.forecasts);\n\n          case 12:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function getForecasts(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\nexport var getDailyWeather = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(lat, lon) {\n    var date, formattedDate, access_token, url, req, res;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            date = new Date();\n            formattedDate = date.toISOString().split(\"T\")[0];\n            _context2.next = 4;\n            return getAccessToken();\n\n          case 4:\n            access_token = _context2.sent;\n            url = dailyWeatherUrl(lat, lon, formattedDate);\n            _context2.next = 8;\n            return axios.get(url, {\n              headers: {\n                Authorization: \"Bearer \".concat(access_token),\n                \"Access-Control-Allow-Origin\": \"*\",\n                \"Access-Control-Allow-Methods\": \"*\",\n                \"Access-Control-Allow-Headers\": \"*\"\n              }\n            });\n\n          case 8:\n            req = _context2.sent;\n            _context2.next = 11;\n            return req.data;\n\n          case 11:\n            res = _context2.sent;\n            console.log(res);\n            return _context2.abrupt(\"return\", res.forecast[0]);\n\n          case 14:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function getDailyWeather(_x3, _x4) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nvar getAccessToken = /*#__PURE__*/function () {\n  var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n    var api_key, api_secret, encodedKey, req, res;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            api_key = process.env.AWHERE_KEY;\n            api_secret = process.env.AWHERE_SECRET;\n            encodedKey = Buffer.from(\"\".concat(api_key, \":\").concat(api_secret)).toString(\"base64\");\n            _context3.next = 5;\n            return axios.post(tokenUrl, \"grant_type=client_credentials\", {\n              headers: {\n                \"Access-Control-Allow-Origin\": \"*\",\n                \"Content-Type\": \"application/x-www-form-urlencoded\",\n                Authorization: \"Basic \".concat(encodedKey),\n                \"Access-Control-Allow-Methods\": \"*\",\n                \"Access-Control-Allow-Headers\": \"*\"\n              }\n            });\n\n          case 5:\n            req = _context3.sent;\n            console.log(req);\n            _context3.next = 9;\n            return req.data;\n\n          case 9:\n            res = _context3.sent;\n            console.log(res);\n            return _context3.abrupt(\"return\", res.access_token);\n\n          case 12:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function getAccessToken() {\n    return _ref3.apply(this, arguments);\n  };\n}();","map":null,"metadata":{},"sourceType":"module"}