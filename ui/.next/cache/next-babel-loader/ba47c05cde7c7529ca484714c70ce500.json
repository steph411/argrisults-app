{"ast":null,"code":"// import fetch from  \"node-fetch\"\nimport axios from 'axios';\nconst tokenUrl = \"https://api.awhere.com/oauth/token\";\nconst baseApiUrl = process.env.BASE_API_URL;\n\nconst forecastsUrl = (lat, lon) => `${baseApiUrl}/weather/locations/${lat},${lon}/forecasts`;\n\nconst dailyWeatherUrl = (lat, lon, date = \"\") => {\n  let result = `${baseApiUrl}/weather/locations/${lat},${lon}/forecasts`;\n\n  if (date) {\n    result = `${result}/${date}`;\n  }\n\n  return result;\n};\n\nexport const getForecasts = async (lat, lon, accessToken = undefined) => {\n  let access_token = accessToken;\n\n  if (!accessToken) {\n    access_token = await getAccessToken();\n  }\n\n  const url = forecastsUrl(lat, lon);\n  console.log({\n    apiurl: url\n  });\n  const req = await axios.get(url, {\n    headers: {\n      Authorization: `Bearer ${access_token}`,\n      \"Access-Control-Allow-Origin\": \"*\",\n      \"Access-Control-Allow-Methods\": \"*\",\n      \"Access-Control-Allow-Headers\": \"*\"\n    }\n  });\n  const res = await req.data;\n  console.log(res);\n  return res.forecasts;\n};\nexport const getDailyWeather = async (lat, lon, accessToken = undefined) => {\n  let access_token = accessToken;\n\n  if (!accessToken) {\n    access_token = await getAccessToken();\n  }\n\n  let date = new Date();\n  const formattedDate = date.toISOString().split(\"T\")[0];\n  const url = dailyWeatherUrl(lat, lon, formattedDate);\n  const req = await axios.get(url, {\n    headers: {\n      Authorization: `Bearer ${access_token}`,\n      \"Access-Control-Allow-Origin\": \"*\",\n      \"Access-Control-Allow-Methods\": \"*\",\n      \"Access-Control-Allow-Headers\": \"*\"\n    }\n  });\n  const res = await req.data;\n  console.log(res);\n  return res.forecast[0];\n};\nexport const getAccessToken = async () => {\n  const api_key = process.env.AWHERE_KEY;\n  const api_secret = process.env.AWHERE_SECRET;\n  const encodedKey = Buffer.from(`${api_key}:${api_secret}`).toString(\"base64\");\n  const req = await axios.post(tokenUrl, \"grant_type=client_credentials\", {\n    headers: {\n      \"Access-Control-Allow-Origin\": \"*\",\n      \"Content-Type\": \"application/x-www-form-urlencoded\",\n      Authorization: `Basic ${encodedKey}`,\n      \"Access-Control-Allow-Methods\": \"*\",\n      \"Access-Control-Allow-Headers\": \"*\"\n    }\n  });\n  console.log(req);\n  const res = await req.data;\n  console.log(res);\n  return res.access_token;\n};","map":null,"metadata":{},"sourceType":"module"}