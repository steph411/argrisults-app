{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n// import fetch from  \"node-fetch\"\nimport axios from 'axios';\nvar tokenUrl = \"https://api.awhere.com/oauth/token\";\nvar baseApiUrl = \"https://api.awhere.com/v2\";\n\nvar forecastsUrl = function forecastsUrl(lat, lon) {\n  return \"\".concat(baseApiUrl, \"/weather/locations/\").concat(lat, \",\").concat(lon, \"/forecasts\");\n};\n\nvar dailyWeatherUrl = function dailyWeatherUrl(lat, lon) {\n  var date = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : \"\";\n  var result = \"\".concat(baseApiUrl, \"/weather/locations/\").concat(lat, \",\").concat(lon, \"/forecasts\");\n\n  if (date) {\n    result = \"\".concat(result, \"/\").concat(date);\n  }\n\n  return result;\n};\n\nexport var getForecasts = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(lat, lon) {\n    var accessToken,\n        access_token,\n        url,\n        req,\n        res,\n        _args = arguments;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            accessToken = _args.length > 2 && _args[2] !== undefined ? _args[2] : undefined;\n            access_token = accessToken;\n\n            if (accessToken) {\n              _context.next = 6;\n              break;\n            }\n\n            _context.next = 5;\n            return getAccessToken();\n\n          case 5:\n            access_token = _context.sent;\n\n          case 6:\n            url = forecastsUrl(lat, lon);\n            console.log({\n              apiurl: url\n            });\n            _context.next = 10;\n            return axios.get(url, {\n              headers: {\n                Authorization: \"Bearer \".concat(access_token) // \"Access-Control-Allow-Origin\": \"*\",\n                // \"Access-Control-Allow-Methods\": \"*\",\n                // \"Access-Control-Allow-Headers\": \"*\"\n\n              }\n            });\n\n          case 10:\n            req = _context.sent;\n            _context.next = 13;\n            return req.data;\n\n          case 13:\n            res = _context.sent;\n            console.log(res);\n            return _context.abrupt(\"return\", res.forecasts);\n\n          case 16:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function getForecasts(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\nexport var getDailyWeather = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(lat, lon) {\n    var accessToken,\n        access_token,\n        date,\n        formattedDate,\n        url,\n        req,\n        res,\n        _args2 = arguments;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            accessToken = _args2.length > 2 && _args2[2] !== undefined ? _args2[2] : undefined;\n            access_token = accessToken;\n\n            if (accessToken) {\n              _context2.next = 6;\n              break;\n            }\n\n            _context2.next = 5;\n            return getAccessToken();\n\n          case 5:\n            access_token = _context2.sent;\n\n          case 6:\n            date = new Date();\n            formattedDate = date.toISOString().split(\"T\")[0];\n            url = dailyWeatherUrl(lat, lon, formattedDate);\n            _context2.next = 11;\n            return axios.get(url, {\n              headers: {\n                Authorization: \"Bearer \".concat(access_token) // \"Access-Control-Allow-Origin\": \"*\",\n                // \"Access-Control-Allow-Methods\": \"*\",\n                // \"Access-Control-Allow-Headers\": \"*\"\n\n              }\n            });\n\n          case 11:\n            req = _context2.sent;\n            _context2.next = 14;\n            return req.data;\n\n          case 14:\n            res = _context2.sent;\n            console.log(res);\n            return _context2.abrupt(\"return\", res.forecast[0]);\n\n          case 17:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function getDailyWeather(_x3, _x4) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexport var getAccessToken = /*#__PURE__*/function () {\n  var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n    var api_key, api_secret, encodedKey, req, res;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            api_key = process.env.AWHERE_KEY;\n            api_secret = process.env.AWHERE_SECRET;\n            encodedKey = Buffer.from(\"\".concat(api_key, \":\").concat(api_secret)).toString(\"base64\");\n            _context3.next = 5;\n            return axios.post(tokenUrl, \"grant_type=client_credentials\", {\n              headers: {\n                \"Access-Control-Allow-Origin\": \"*\",\n                \"Content-Type\": \"application/x-www-form-urlencoded\",\n                Authorization: \"Basic \".concat(encodedKey),\n                \"Access-Control-Allow-Methods\": \"*\",\n                \"Access-Control-Allow-Headers\": \"*\"\n              }\n            });\n\n          case 5:\n            req = _context3.sent;\n            console.log(req);\n            _context3.next = 9;\n            return req.data;\n\n          case 9:\n            res = _context3.sent;\n            console.log(res);\n            return _context3.abrupt(\"return\", res.access_token);\n\n          case 12:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function getAccessToken() {\n    return _ref3.apply(this, arguments);\n  };\n}();","map":{"version":3,"sources":["/Users/lioneletaba/Documents/Projets/Perso/argrisults-app/ui/services/index.ts"],"names":["axios","tokenUrl","baseApiUrl","forecastsUrl","lat","lon","dailyWeatherUrl","date","result","getForecasts","accessToken","undefined","access_token","getAccessToken","url","console","log","apiurl","get","headers","Authorization","req","data","res","forecasts","getDailyWeather","Date","formattedDate","toISOString","split","forecast","api_key","process","env","AWHERE_KEY","api_secret","AWHERE_SECRET","encodedKey","Buffer","from","toString","post"],"mappings":"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","sourcesContent":["// import fetch from  \"node-fetch\"\nimport axios from 'axios'\n\nconst tokenUrl = \"https://api.awhere.com/oauth/token\"\nconst baseApiUrl = \"https://api.awhere.com/v2\"\nconst forecastsUrl = (lat, lon) => `${baseApiUrl}/weather/locations/${lat},${lon}/forecasts`\nconst dailyWeatherUrl = (lat, lon, date=\"\") => {\n  let result = `${baseApiUrl}/weather/locations/${lat},${lon}/forecasts`\n  if (date){\n    result = `${result}/${date}`\n  }\n  return result;\n\n}\n\n  \n\n\nexport const getForecasts = async (lat, lon, accessToken=undefined) => {\n  \n  let access_token = accessToken;\n  if (!accessToken) {\n    access_token = await getAccessToken(); \n  }\n  const url = forecastsUrl(lat, lon);\n  console.log({apiurl: url})\n  const req = await axios.get(url, {\n    headers: {\n      Authorization: `Bearer ${access_token}`,\n      // \"Access-Control-Allow-Origin\": \"*\",\n      // \"Access-Control-Allow-Methods\": \"*\",\n      // \"Access-Control-Allow-Headers\": \"*\"\n    }\n  })\n  const res = await req.data\n  console.log(res)\n  return res.forecasts\n}\n\n\nexport const getDailyWeather = async (lat, lon, accessToken = undefined) => {\n  let access_token = accessToken;\n  if (!accessToken) {\n    access_token = await getAccessToken(); \n  }\n  let date = new Date();\n  const formattedDate = date.toISOString().split(\"T\")[0];\n  const url = dailyWeatherUrl(lat, lon, formattedDate);\n  const req = await axios.get(url, {\n    headers: {\n      Authorization: `Bearer ${access_token}`,\n      // \"Access-Control-Allow-Origin\": \"*\",\n      // \"Access-Control-Allow-Methods\": \"*\",\n      // \"Access-Control-Allow-Headers\": \"*\"\n    }\n  })\n  const res = await req.data\n  console.log(res)\n  return res.forecast[0]\n}\n\n\n\n\n\n\nexport const getAccessToken = async () => {\n  const api_key = process.env.AWHERE_KEY;\n  const api_secret = process.env.AWHERE_SECRET;\n  const encodedKey = Buffer.from(`${api_key}:${api_secret}`).toString(\"base64\");\n  const req = await axios.post(tokenUrl, \"grant_type=client_credentials\", {\n    headers: {\n      \"Access-Control-Allow-Origin\": \"*\",\n      \"Content-Type\": \"application/x-www-form-urlencoded\",\n      Authorization: `Basic ${encodedKey}`,\n      \"Access-Control-Allow-Methods\": \"*\",\n      \"Access-Control-Allow-Headers\": \"*\"\n    }\n  })\n  console.log(req)\n  const res  = await req.data\n  console.log(res);\n  return res.access_token\n}"]},"metadata":{},"sourceType":"module"}